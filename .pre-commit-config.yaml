---
# Pre-commit hooks for turing-ansible-cluster
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # General file hygiene
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-yaml
        args: [--unsafe]  # Allow custom tags in Ansible
        exclude: ^ansible/roles/geerlingguy
      - id: check-added-large-files
        args: [--maxkb=1024]
      - id: check-merge-conflict
      - id: detect-private-key
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        args: [-c, .yamllint]
        exclude: ^ansible/roles/geerlingguy

  # Ansible linting
  - repo: https://github.com/ansible/ansible-lint
    rev: v25.1.3
    hooks:
      - id: ansible-lint
        name: ansible-lint
        entry: ansible-lint
        language: python
        files: \.(yml|yaml)$
        exclude: ^(ansible/roles/geerlingguy|\.github/)
        args:
          - --config-file=ansible/.ansible-lint
          - ansible/

  # Shell script linting
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.10.0.1
    hooks:
      - id: shellcheck
        args: [--severity=warning]
        files: ^scripts/

  # Terraform formatting and validation
  - repo: https://github.com/antonbabenko/pre-commit-terraform
    rev: v1.96.2
    hooks:
      - id: terraform_fmt
      - id: terraform_validate
        args:
          - --hook-config=--retry-once-with-cleanup=true
          - --tf-init-args=-backend=false

  # Secret detection
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.21.2
    hooks:
      - id: gitleaks

  # Markdown linting (optional, warn only)
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.43.0
    hooks:
      - id: markdownlint
        args: [--disable, MD013, MD033, MD041, --]  # Disable line-length, inline HTML, first-line heading
        exclude: ^(CHANGELOG\.md|ansible/roles/geerlingguy)

# CI configuration
ci:
  autofix_commit_msg: "style: auto-fix from pre-commit hooks"
  autoupdate_commit_msg: "chore: update pre-commit hook versions"
  skip: [terraform_validate]  # Skip in CI (needs terraform init)
