# K3s server configuration
# Matches Talos cluster networking

cluster-cidr: "{{ pod_cidr }}"
service-cidr: "{{ service_cidr }}"
cluster-dns: "{{ cluster_dns | default('10.96.0.10') }}"
cluster-domain: "{{ cluster_domain }}"

# Disable built-in components we'll replace with Helm
disable:
  - traefik
  - servicelb

# TLS SANs for API server
tls-san:
  - "{{ ansible_host }}"
  - "{{ inventory_hostname }}"
  - "{{ cluster_name }}"

# Flannel (default CNI, matches Talos)
flannel-backend: vxlan

# Write kubeconfig with secure permissions (owner-only access)
write-kubeconfig-mode: "0600"

# Kubelet args for Longhorn
kubelet-arg:
  - "max-pods=110"
