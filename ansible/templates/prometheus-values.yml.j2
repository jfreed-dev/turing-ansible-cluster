# kube-prometheus-stack Helm values
# Matches Talos cluster monitoring configuration

prometheus:
  prometheusSpec:
    retention: 15d
    retentionSize: 18GB
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: longhorn
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 20Gi
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 2Gi
    # ARM64 optimizations
    podMonitorSelectorNilUsesHelmValues: false
    serviceMonitorSelectorNilUsesHelmValues: false
    additionalScrapeConfigs:
      - job_name: 'aria-streaming'
        static_configs:
          - targets: ['10.10.88.120:5182']
        metrics_path: '/api/metrics/prometheus'
        scrape_interval: 30s
      - job_name: 'k3s-node-exporter'
        static_configs:
          - targets:
            - '10.10.88.73:9100'
            - '10.10.88.74:9100'
            - '10.10.88.75:9100'
            - '10.10.88.76:9100'
        scrape_interval: 30s

alertmanager:
  alertmanagerSpec:
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: longhorn
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 5Gi

grafana:
  adminPassword: "{{ grafana_admin_password | default('admin') }}"
  service:
    type: LoadBalancer
    loadBalancerIP: "{{ grafana_lb_ip | default('10.10.88.86') }}"
  persistence:
    enabled: true
    storageClassName: longhorn
    size: 5Gi
  sidecar:
    dashboards:
      enabled: true
      searchNamespace: ALL

# Node exporter disabled â€” npu-device-monitor DaemonSet already provides
# node_exporter metrics on hostPort 9100 on all worker nodes
nodeExporter:
  enabled: false

# Kube-state-metrics
kubeStateMetrics:
  enabled: true

# Disable components not needed on ARM
kubeEtcd:
  enabled: false  # K3s embeds etcd differently

kubeControllerManager:
  enabled: false  # K3s uses different paths

kubeScheduler:
  enabled: false  # K3s uses different paths

kubeProxy:
  enabled: false  # K3s manages this internally
